<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">


<script>function deletecart(id) {
    var xhr = new XMLHttpRequest();
                          xhr.open('POST', '/api/detetecartall', true);
                          xhr.setRequestHeader('Content-Type', 'application/json');
                          xhr.send(JSON.stringify({
                          'user_id': '{{session.get('email')}}',
                          }));
    window.location.href = '/success?id='+id;
}

function maketransactiongrp(newpayable,grpid) {
    console.log(grpid)
    var xhr = new XMLHttpRequest();
                          xhr.open('POST', '/api/create_transaction_grp', true);
                          xhr.setRequestHeader('Content-Type', 'application/json');
                          xhr.send(JSON.stringify({
                          'user_id': '{{session.get('email')}}',
                          'transaction_type':1,
                          'amount':newpayable,
                              'grpid':grpid
                          }));
}

function maketransaction(amount) {
    console.log(amount);
    var xhr = new XMLHttpRequest();
                          xhr.open('POST', '/api/create_transaction', true);
                          xhr.setRequestHeader('Content-Type', 'application/json');
                          xhr.send(JSON.stringify({
                          'user_id': '{{session.get('email')}}',
                          'transaction_type':1,
                          'amount':amount
                          }));

    }

iscouponcodepercentage =null
    autodiscount_percentage=null
    autodiscount_applied=false;
    iscouponcodeapplied=false;
    newpayable={{ payable }};
</script>
       <style>
.button {
  background-color: #04AA6D; /* Green */
  border: none;
  color: white;
  padding: 8px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
}

.button1 {border-radius: 2px;}
.button2 {border-radius: 4px;}
.button3 {border-radius: 8px;}
.button4 {border-radius: 8px;}
.button5 {border-radius: 50%;}
</style>




<style>
.alert {
  padding: 20px;
  background-color: #f44336;
  color: white;
}

.paymentmodes {
    box-shadow: 5px 10px #888888;
    padding: 20px;
    background-color: #6194e8;
    color: white;
}

.closebtn {
  margin-left: 15px;
  color: white;
  font-weight: bold;
  float: right;
  font-size: 22px;
  line-height: 20px;
  cursor: pointer;
  transition: 0.3s;
}

.closebtn:hover {
  color: black;
}
</style>

    <style>

table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}
th, td {
  padding: 5px;
  text-align: left;
}
</style>

  <title>{{ about_title }}</title>
{#  <meta content="{{ aboutpagemeta }}" name="description">#}
{#  <meta content="{{ aboutpagemetakeyword }}" name="keywords">#}
    <meta name="robots" content="INDEX,FOLLOW">
  <!-- Favicons -->
{#  <link href="{{ url_for('static',filename='img/favicon.png') }}" rel="icon">#}
{#  <link href="assets/img/favicon.png" rel="icon">#}
  <link href="{{ url_for('static',filename='img/apple-touch-icon.png') }}" rel="apple-touch-icon">
{#  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">#}

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="{{ url_for('static',filename='vendor/animate.css/animate.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static',filename='vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static',filename='vendor/bootstrap-icons/bootstrap-icons.css') }}" rel="stylesheet">
  <link href="{{ url_for('static',filename='vendor/boxicons/css/boxicons.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static',filename='vendor/glightbox/css/glightbox.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static',filename='vendor/swiper/swiper-bundle.min.css') }}" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="{{ url_for('static',filename='styles/style.css') }}" rel="stylesheet">

</head>

<body>

  <!-- ======= Top Bar ======= -->
  <section id="topbar" class="d-flex align-items-center">
    <div class="container d-flex justify-content-center justify-content-md-between">
      <div class="contact-info d-flex align-items-center">
        <i class="bi bi-envelope d-flex align-items-center"><a href="mailto:contact@example.com">{{ companymail }}</a></i>
        <i class="bi bi-phone d-flex align-items-center ms-4"><span>{{ companyphone }}</span></i>
      </div>
      <div class="social-links d-none d-md-flex align-items-center">
        <a href="{{ companytwitter }}" class="twitter"><i class="bi bi-twitter"></i></a>
        <a href="{{ companyfacebook }}" class="facebook"><i class="bi bi-facebook"></i></a>
        <a href="{{ companyinstagram }}" class="instagram"><i class="bi bi-instagram"></i></a>
        <a href="{{ companylinkedin }}" class="linkedin"><i class="bi bi-linkedin"></i></a>
      </div>
    </div>
  </section>

  <!-- ======= Header ======= -->
  <header id="header" class="d-flex align-items-center">
    <div class="container d-flex justify-content-between align-items-center">

      <div class="logo">
{#        <h1><a href="/">Eterna</a></h1>#}
        <!-- Uncomment below if you prefer to use an image logo -->
        <a href="/"><img  src="{{ applogo }}" alt="" class="img-fluid"></a>
      </div>

            <nav id="navbar" class="navbar">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a class="active" href="/about">About</a></li>
          <li><a href="/pricing">Pricing</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/contact">Contact</a></li>
                    <li><a href="/faq">FAQ</a></li>
          <li class="dropdown"><a href="#"><span>My Account</span> <i class="bi bi-chevron-down"></i></a>
            <ul>
{#              <li><a href="#">Drop Down 1</a></li>#}
                {% if userlogedin == True %}
                    <div class="row">
                    <div align="center">

                    <h6>Welcome<br><b>{{ username }}</b></h6>
                    </div>
                    </div>
                  <li><a href="/myorders">My Orders</a></li>
                  <li><a href="/myaccount">My Account</a></li>
                  <li><a href="/mywallet">My Wallet</a></li>
                  <li><a href="/mygroups">My Groups</a></li>
                  <li><a href="/userlogout">Logout</a></li>
                {% endif %}
             {% if userlogedin == False %}
                  <li><a href="/userlogin">Login</a></li>
                  <li><a href="/userregister">Register</a></li>
                {% endif %}
            </ul>
          </li>
          <li><a href="/ordernew">Order</a></li>
          <li class="bi bi-cart d-flex align-items-center ms-4"><a href="/cart">Cart</a><span style="margin-left: 10px" class='badge badge-warning' id='lblCartCount'>0</span></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->
    </div>
  </header><!-- End Header -->

  <main id="main">

    <!-- ======= Breadcrumbs ======= -->
    <section id="breadcrumbs" class="breadcrumbs">
      <div class="container">

        <ol>
          <li><a href="/">Home</a></li>
          <li>Checkout</li>
        </ol>
        <h2>Checkout ({{ itemlist|length }} items)</h2>

      </div>
    </section><!-- End Breadcrumbs -->

    <!-- ======= About Section ======= -->
    <section id="about" class="about">
      <div class="container">

        <div class="row">
          <div class="col-lg-6">
             <table style="width:100%">
              <tr>
                <th>Name</th>
                <th>Quantity</th>
                <th>Price</th>
              </tr>
                 {% for i in range(itemlist|length) %}
                     <tr>
                        <td>{{ itemlist[i]['title']}}</td>
                        <td>{{ itemlist[i]['qty']}}</td>
                        <td>${{ itemlist[i]['price']}}</td>
                     </tr>
                 {% endfor %}
             <tr>
                 <td><b>Total</b></td>
                 <td></td>
                 <td><b>${{ totalp }}</b></td>
             </tr>
            </table>
          </div>
          <div class="col-lg-6 pt-4 pt-lg-0 content">
            <h3>Choose Payment Mode</h3>
              <div>
                  {% if  grpdetails!=None %}
                  <div class="alert">
                      <strong>Congrats !</strong> ${{ discamount }} is waived of exclusive for you as {{ grpdetails[1] }}.<br>
                  </div>
                  {% endif %}

              <div id="couponsuccess" style="display: none" class="alert">
                          <strong >Congrats ! </strong>Coupon Code applied. you got {{ coupons[3] }}% discount
              </div>

              {% if coupons %}
                  <input id="couponcode" class="form-control" placeholder="Enter coupon code">
                  <button id="btncheck" onclick="function checkcoupon() {
                      if (document.getElementById('couponcode').value=='{{ coupons[2] }}'){
                          discountedamount = {{ coupons[3] }}/100
                          newpayable = {{ payable }}-(discountedamount*{{ payable }})
                          document.getElementById('payable').innerHTML='Payable : $'+newpayable
                          document.getElementById('couponcode').style.display='none';
                          document.getElementById('btncheck').style.display='none';
                          document.getElementById('couponfailure').style.display='none';
                          document.getElementById('couponsuccess').style.display='block';
                          iscouponcodeapplied = true;
                          iscouponcodepercentage = {{ coupons[3] }}
                          }
                      else {
                          console.log(false)
                          document.getElementById('couponfailure').style.display='block';
                          }


                  }
                  checkcoupon()" class="button button4">Check</button>
                  <div id="couponfailure" style="display: none" class="alert">
                          <strong >Sorry ! </strong>Invalid Coupon
                  </div>
              {% endif %}
                  <h4 id="payable">Payable : ${{ payable }}</h4>
              <button id="paypal-button" style="width: 100%"><b><i>Click on Card images to pay with debit/credit cards</i></b></button>
              <!-- <button id="paypal-button2" style="width: 100%" class="button button4"><b><i>Credit Card/Debit Card</i></b></button> -->
              {% for i in range(groupswalletlist|length) %}
                  <button onclick="function checkpaymentmode() {
                      if (newpayable>{{ groupswalletlist[i][1] }}){
                              if (confirm('Low Balance Recharge To Continue?') == true) {
                                  window.open('/mywallet','_self');
                                  console.log('ok')
                              } else {
                                  console.log('cancel')
                              }

                          }
                      else {
                          console.log('ok')

                          {% if grpdetails!=None%}
                          autodiscount_applied=true;
                              autodiscount_percentage={{ grpdetails[2] }};
                          {% endif %}
                                            var xhr = new XMLHttpRequest();

                           xhr.onreadystatechange = function() {
                            if (xhr.readyState === 4) {
                                maketransactiongrp(newpayable,'{{ groupswalletlist[i][0] }}');
                           deletecart(xhr.response);
                            }
                          }
                          xhr.open('POST', '/checkout', true);
                          xhr.setRequestHeader('Content-Type', 'application/json');
                          xhr.send(JSON.stringify({
                          'type': 'Group_Wallet-{{ groupswalletlist[i][0] }}',
                          'couponcode_isapplied':iscouponcodeapplied,
                          'couponcode_percentage':iscouponcodepercentage,
                          'autodiscount_applied':autodiscount_applied,
                          'autodiscount_percentage':autodiscount_percentage
                          }));

                          }

                  }
                  checkpaymentmode()"  style="width: 100%" class="button button4"><a>Proceed With</a><br><a>Group Wallet : {{ groupswalletlist[i][0] }} </a><br><b>Balance : ${{ groupswalletlist[i][1]  }}</b><i class="fa fa-forward"></i></button>
              {% endfor %}
                  <button onclick="function paymentmodemywallet(){
                      if (newpayable>{{ pwalletamount }}){
                          console.log(newpayable)
                            if (confirm('Low Balance Recharge To Continue?') == true) {
                                  window.open('/mywallet','_self');
                                  console.log('ok')
                              } else {
                                  console.log('cancel')
                              }
                          }
                      else {
                          {% if grpdetails!=None%}
                          autodiscount_applied=true;
                          autodiscount_percentage={{ grpdetails[2] }};
                          {% endif %}
                          var xhr = new XMLHttpRequest();
                           xhr.onreadystatechange = function() {
                            if (xhr.readyState === 4) {
                                maketransaction(newpayable);
                                deletecart(xhr.response);
                            }
                          }
                          xhr.open('POST', '/checkout', true);
                          xhr.setRequestHeader('Content-Type', 'application/json');
                          xhr.send(JSON.stringify({
                          'type': 'personal_wallet',
                          'couponcode_isapplied':iscouponcodeapplied,
                          'couponcode_percentage':iscouponcodepercentage,
                          'autodiscount_applied':autodiscount_applied,
                          'autodiscount_percentage':autodiscount_percentage
                          }));
                          }
                  } paymentmodemywallet()"  style="width: 100%" class="button button4"><b>Proceed With My wallet </b><br><b>Balance : ${{ pwalletamount }}</b><i class="fa fa-forward"></i></button>
              </div>
          </div>
        </div>
      </div>
    </section><!-- End About Section -->



  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">


    <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>{{ appname }}</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        Designed by <a href="http://aerialestimation.com/">{{ author }}</a>
      </div>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <!-- Vendor JS Files -->
  <script src="{{ url_for('static',filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static',filename='vendor/glightbox/js/glightbox.min.js') }}"></script>
  <script src="{{ url_for('static',filename='vendor/isotope-layout/isotope.pkgd.min.js') }}"></script>
  <script src="{{ url_for('static',filename='vendor/php-email-form/validate.js') }}"></script>
  <script src="{{ url_for('static',filename='vendor/purecounter/purecounter.js') }}"></script>
  <script src="{{ url_for('static',filename='vendor/swiper/swiper-bundle.min.js') }}"></script>
  <script src="{{ url_for('static',filename='vendor/waypoints/noframework.waypoints.js') }}"></script>

  <!-- Template Main JS File -->
{#  <script src="assets/js/main.js"></script>#}
  <script src="{{ url_for('static',filename='js/main.js') }}"></script>



<script src="https://www.paypalobjects.com/api/checkout.js"></script>



<script>
    var CREATE_PAYMENT_URL  = '/payment';
    var EXECUTE_PAYMENT_URL = '/execute';

    paypal.Button.render({
      style: {
        layout: 'vertical',
        color:  'blue',
        shape:  'rect',
        label:  'paypal',
      },
      funding: {
        allowed: [ paypal.FUNDING.CARD ],
        disallowed: [ paypal.FUNDING.CREDIT ]
       },
        env: 'production', // Or 'sandbox'

        commit: true, // Show a 'Pay Now' button

        payment: function() {
            {% if grpdetails!=None%}
                autodiscount_applied=true;
                autodiscount_percentage={{ grpdetails[2] }};
            {% endif %}
            return paypal.request({
                    method: 'post',
                    url: CREATE_PAYMENT_URL,
                    json: {
                        payable: newpayable,
                    }
                }).then(function(data) {
                return data.paymentID;
            });
        },

        onAuthorize: function(data) {
            return paypal.request.post(EXECUTE_PAYMENT_URL, {
                paymentID: data.paymentID,
                payerID:   data.payerID
            }).then(function(res) {
                console.log(res.success)
                          var xhr = new XMLHttpRequest();
                 xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
        deletecart();
        window.location.replace('/success?id='+xhr.response)
    }
  }
                          xhr.open('POST', '/checkout', true);
                          xhr.setRequestHeader('Content-Type', 'application/json');
                          xhr.send(JSON.stringify({
                          'type': 'Paypal',
                          'couponcode_isapplied':iscouponcodeapplied,
                          'couponcode_percentage':iscouponcodepercentage,
                          'autodiscount_applied':autodiscount_applied,
                          'autodiscount_percentage':autodiscount_percentage
                          }));
                // The payment is complete!
                // You can now show a confirmation message to the customer
            });
        }

    }, '#paypal-button');
</script>



</body>

</html>